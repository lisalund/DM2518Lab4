<!DOCTYPE html>
<html>
<head>
  <style>
    p {
      font-family: verdana;
      font-size: 400px;
      color: #FFFFFF;
    }
  </style>
  <title>Compass</title>
  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.js"></script>
  <script>
      let direction = null;
      // Get event data
      function deviceOrientationListener(event) {
          var alpha    = event.alpha; //z axis rotation [0,360)
          var beta     = event.beta; //x axis rotation [-180, 180]
          var gamma    = event.gamma; //y axis rotation [-90, 90]
          //Check if absolute values have been sent
          if (typeof event.webkitCompassHeading !== "undefined") {
              alpha = event.webkitCompassHeading; //iOS non-standard
              var heading = alpha
              //document.getElementById("heading").innerHTML = heading.toFixed([0]);
          }
          else {
              //alert("Your device is reporting relative alpha values, so this compass won't point north ðŸ˜ž");
              var heading = 360 - alpha; //heading [0, 360)
              //document.getElementById("heading").innerHTML = heading.toFixed([0]);
          }

          // Change backgroud colour based on heading
          // Green for North and South, black otherwise
          if (heading > 315 || heading <= 45) { //Allow +- 45 degree
              direction = "N";
          }
          else if (heading > 135 && heading <= 225){ //Allow +- 45 degree
              direction= "S";
          }
          else if (heading > 225 && heading <= 315){ //Allow +- 45 degree
              direction = "E";
          }
          else if (heading > 45 && heading <= 135){ //Allow +- 45 degree
              direction="W";
          }
      }

      var pubnubDemo = new PubNub({
          publishKey: 'pub-c-26d74004-c975-4240-9d18-1d05178629b8',
          subscribeKey: 'sub-c-eec5326a-67ed-11e9-89f1-56e8a30b5f0e'
      });

      pubnubDemo.addListener({
          message: function(message) {
              alert(message)
          }
      });

      function subscribe(channel){
          pubnubDemo.subscribe({
              channels: [channel]
          });
      }

      function publish(message, channel){
          pubnubDemo.publish({
              message: {
                  message
              },
              channel: channel
          });
      }

      function onClick(){
          alert(direction);
          console.log("Button clicked");
      }

      // Check if device can provide absolute orientation data
      if (window.DeviceOrientationAbsoluteEvent) {
          window.addEventListener("DeviceOrientationAbsoluteEvent", deviceOrientationListener);
      } // If not, check if the device sends any orientation data
      else if(window.DeviceOrientationEvent){
          window.addEventListener("deviceorientation", deviceOrientationListener);
      } // Send an alert if the device isn't compatible
      else {
          alert("Sorry, try again on a compatible mobile device!");
      }
  </script>

</head>
<body>
<br><br>
<p id="heading" style="text-align:center"></p>
<button onClick="onClick">Click me!</button>
</body>
</html>